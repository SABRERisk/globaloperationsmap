<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Operations Map</title>
  <link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&amp;family=Outfit:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Play', sans-serif;
      overflow: hidden;
    }

    html, body, .globe-wrapper {
      height: 100%;
      width: 100%;
    }

    .globe-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #0a0e27;
    }

    .header {
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 10;
      pointer-events: none;
    }

    .header h1 {
      margin: 0 0 8px 0;
      font-weight: 700;
      line-height: 1.2;
      font-size: 32px;
      color: #ffffff;
    }

    .header p {
      margin: 0;
      font-weight: 400;
      opacity: 0.9;
      font-size: 16px;
      color: #ffffff;
    }

    .globe-container {
      position: relative;
      width: 600px;
      height: 600px;
      margin: auto;
    }

    canvas {
      display: block;
      cursor: grab;
    }

    canvas:active {
      cursor: grabbing;
    }

    .legend {
      position: absolute;
      bottom: 30px;
      right: 30px;
      padding: 20px;
      border-radius: 12px;
      backdrop-filter: blur(12px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      z-index: 10;
      background: rgba(26, 31, 58, 0.4);
      color: #ffffff;
    }

    .legend-title {
      font-weight: 700;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      box-shadow: 0 0 8px currentColor;
      background: rgb(1, 26, 130);
    }

    .controls {
      position: absolute;
      bottom: 30px;
      left: 30px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    .control-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-family: 'Play', sans-serif;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      background: #7c3aed;
      color: #ffffff;
    }

    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    @media (max-width: 768px) {
      .globe-container {
        width: 90vw;
        height: 90vw;
        max-width: 500px;
        max-height: 500px;
      }

      .header {
        top: 20px;
      }

      .header h1 {
        font-size: 24px;
      }

      .header p {
        font-size: 14px;
      }

      .legend {
        bottom: 15px;
        right: 15px;
        padding: 15px;
      }

      .controls {
        bottom: 15px;
        left: 15px;
      }

      .control-btn {
        padding: 10px 16px;
        font-size: 13px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="globe-wrapper">
   <div class="header">
    <h1>Where We Operate</h1>
    <p>Global Presence</p>
   </div>
   <div class="globe-container">
    <canvas id="globeCanvas"></canvas>
   </div>
   <div class="legend">
    <div class="legend-title">
     Our Locations
    </div>
    <div class="legend-item">
     <div class="legend-dot"></div><span>Areas of Operations</span>
    </div>
   </div>
   <div class="controls"><button class="control-btn" id="rotateBtn">Auto Rotate</button> <button class="control-btn" id="resetBtn">Reset View</button>
   </div>
  </div>
  <script>
    let worldData = null;
    
    async function loadWorldData() {
      try {
        const response = await fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson');
        worldData = await response.json();
        drawGlobe();
      } catch (error) {
        console.error('Failed to load world map data:', error);
        drawGlobe();
      }
    }

    const locations = [
      { name: "United States", lat: 37.0902, lon: -95.7129 },
      { name: "Canada", lat: 56.1304, lon: -106.3468 },
      { name: "Mexico", lat: 23.6345, lon: -102.5528 },
      { name: "United Kingdom", lat: 55.3781, lon: -3.4360 },
      { name: "Germany", lat: 51.1657, lon: 10.4515 },
      { name: "France", lat: 46.2276, lon: 2.2137 },
      { name: "Spain", lat: 40.4637, lon: -3.7492 },
      { name: "Italy", lat: 41.8719, lon: 12.5674 },
      { name: "Netherlands", lat: 52.1326, lon: 5.2913 },
      { name: "Sweden", lat: 60.1282, lon: 18.6435 },
      { name: "Norway", lat: 60.4720, lon: 8.4689 },
      { name: "Denmark", lat: 56.2639, lon: 9.5018 },
      { name: "Poland", lat: 51.9194, lon: 19.1451 },
      { name: "Switzerland", lat: 46.8182, lon: 8.2275 },
      { name: "China", lat: 35.8617, lon: 104.1954 },
      { name: "Japan", lat: 36.2048, lon: 138.2529 },
      { name: "India", lat: 20.5937, lon: 78.9629 },
      { name: "Singapore", lat: 1.3521, lon: 103.8198 },
      { name: "South Korea", lat: 35.9078, lon: 127.7669 },
      { name: "UAE", lat: 23.4241, lon: 53.8478 },
      { name: "Israel", lat: 31.0461, lon: 34.8516 },
      { name: "Bahrain", lat: 26.0667, lon: 50.5577 },
      { name: "Qatar", lat: 25.3548, lon: 51.1839 },
      { name: "Oman", lat: 21.4735, lon: 55.9754 },
      { name: "Kuwait", lat: 29.3117, lon: 47.4818 },
      { name: "Saudi Arabia", lat: 23.8859, lon: 45.0792 },
      { name: "Australia", lat: -25.2744, lon: 133.7751 },
      { name: "New Zealand", lat: -40.9006, lon: 174.8860 },
      { name: "Brazil", lat: -14.2350, lon: -51.9253 },
      { name: "Argentina", lat: -38.4161, lon: -63.6167 },
      { name: "Chile", lat: -35.6751, lon: -71.5430 },
      { name: "South Africa", lat: -30.5595, lon: 22.9375 },
      { name: "Johannesburg", lat: -26.2041, lon: 28.0473 },
      { name: "Egypt", lat: 26.8206, lon: 30.8025 },
      { name: "Kenya", lat: -0.0236, lon: 37.9062 }
    ];

    let canvas, ctx;
    let rotation = { x: Math.PI, y: 0 };
    let isDragging = false;
    let lastMouse = { x: 0, y: 0 };
    let autoRotate = false;

    function init() {
      canvas = document.getElementById('globeCanvas');
      const container = canvas.parentElement;
      canvas.width = container.clientWidth;
      canvas.height = container.clientHeight;
      ctx = canvas.getContext('2d');

      setupEventListeners();
      animate();
    }

    function setupEventListeners() {
      canvas.addEventListener('mousedown', (e) => {
        isDragging = true;
        lastMouse = { x: e.clientX, y: e.clientY };
        autoRotate = false;
      });

      canvas.addEventListener('mousemove', (e) => {
        if (isDragging) {
          const deltaX = e.clientX - lastMouse.x;
          const deltaY = e.clientY - lastMouse.y;
          rotation.y += deltaX * 0.01;
          rotation.x -= deltaY * 0.01;
          rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, rotation.x));
          lastMouse = { x: e.clientX, y: e.clientY };
        }
      });

      canvas.addEventListener('mouseup', () => isDragging = false);
      canvas.addEventListener('mouseleave', () => isDragging = false);

      canvas.addEventListener('touchstart', (e) => {
        isDragging = true;
        const touch = e.touches[0];
        lastMouse = { x: touch.clientX, y: touch.clientY };
        autoRotate = false;
        e.preventDefault();
      });

      canvas.addEventListener('touchmove', (e) => {
        if (isDragging) {
          const touch = e.touches[0];
          const deltaX = touch.clientX - lastMouse.x;
          const deltaY = touch.clientY - lastMouse.y;
          rotation.y += deltaX * 0.01;
          rotation.x -= deltaY * 0.01;
          rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, rotation.x));
          lastMouse = { x: touch.clientX, y: touch.clientY };
        }
        e.preventDefault();
      });

      canvas.addEventListener('touchend', () => isDragging = false);

      document.getElementById('rotateBtn').addEventListener('click', () => {
        autoRotate = !autoRotate;
        document.getElementById('rotateBtn').textContent = autoRotate ? 'Stop Rotate' : 'Auto Rotate';
      });

      document.getElementById('resetBtn').addEventListener('click', () => {
        rotation = { x: Math.PI, y: 0 };
        autoRotate = false;
        document.getElementById('rotateBtn').textContent = 'Auto Rotate';
      });

      window.addEventListener('resize', () => {
        const container = canvas.parentElement;
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
      });
    }

    function project3D(lat, lon, radius) {
      const phi = (90 - lat) * (Math.PI / 180);
      const theta = (lon + 180) * (Math.PI / 180);

      let x = radius * Math.sin(phi) * Math.cos(theta);
      let y = radius * Math.cos(phi);
      let z = radius * Math.sin(phi) * Math.sin(theta);

      const cosX = Math.cos(rotation.x);
      const sinX = Math.sin(rotation.x);
      const cosY = Math.cos(rotation.y);
      const sinY = Math.sin(rotation.y);

      const y1 = y * cosX - z * sinX;
      const z1 = y * sinX + z * cosX;
      const x2 = x * cosY - z1 * sinY;
      const z2 = x * sinY + z1 * cosY;

      return { x: x2, y: y1, z: z2 };
    }

    function drawGlobe() {
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(canvas.width, canvas.height) * 0.35;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const gradient = ctx.createRadialGradient(centerX - radius * 0.3, centerY - radius * 0.3, radius * 0.1, centerX, centerY, radius);
      gradient.addColorStop(0, '#2a2f4a');
      gradient.addColorStop(1, '#1a1f3a');

      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.fill();

      drawCountries(centerX, centerY, radius);

      ctx.strokeStyle = '#3a3f5a';
      ctx.lineWidth = 0.5;
      ctx.globalAlpha = 0.3;
      
      for (let lat = -60; lat <= 60; lat += 30) {
        ctx.beginPath();
        for (let lon = -180; lon <= 180; lon += 5) {
          const pos = project3D(lat, lon, radius);
          if (pos.z > 0) {
            const screenX = centerX + pos.x;
            const screenY = centerY + pos.y;
            if (lon === -180) ctx.moveTo(screenX, screenY);
            else ctx.lineTo(screenX, screenY);
          }
        }
        ctx.stroke();
      }

      for (let lon = -180; lon <= 180; lon += 30) {
        ctx.beginPath();
        for (let lat = -90; lat <= 90; lat += 5) {
          const pos = project3D(lat, lon, radius);
          if (pos.z > 0) {
            const screenX = centerX + pos.x;
            const screenY = centerY + pos.y;
            if (lat === -90) ctx.moveTo(screenX, screenY);
            else ctx.lineTo(screenX, screenY);
          }
        }
        ctx.stroke();
      }
      ctx.globalAlpha = 1;

      const sortedLocations = locations
        .map(loc => {
          const pos = project3D(loc.lat, loc.lon, radius);
          return { ...loc, pos, visible: pos.z > 0 };
        })
        .sort((a, b) => a.pos.z - b.pos.z);

      sortedLocations.forEach(loc => {
        if (loc.visible) {
          const screenX = centerX + loc.pos.x;
          const screenY = centerY + loc.pos.y;
          
          const glowGradient = ctx.createRadialGradient(screenX, screenY, 0, screenX, screenY, 15);
          glowGradient.addColorStop(0, 'rgb(1, 26, 130)');
          glowGradient.addColorStop(1, 'transparent');
          ctx.fillStyle = glowGradient;
          ctx.fillRect(screenX - 15, screenY - 15, 30, 30);

          ctx.beginPath();
          ctx.arc(screenX, screenY, 5, 0, Math.PI * 2);
          ctx.fillStyle = 'rgb(1, 26, 130)';
          ctx.fill();
          ctx.strokeStyle = '#ffffff';
          ctx.lineWidth = 2;
          ctx.stroke();

          const pulseRadius = 8 + Math.sin(Date.now() * 0.003) * 3;
          ctx.beginPath();
          ctx.arc(screenX, screenY, pulseRadius, 0, Math.PI * 2);
          ctx.strokeStyle = 'rgb(1, 26, 130)';
          ctx.lineWidth = 1;
          ctx.globalAlpha = 0.5;
          ctx.stroke();
          ctx.globalAlpha = 1;
          
          ctx.font = '12px Play, sans-serif';
          ctx.fillStyle = '#ffffff';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.globalAlpha = 0.9;
          ctx.fillText(loc.name, screenX, screenY - 12);
          ctx.globalAlpha = 1;
        }
      });
    }

    function drawCountries(centerX, centerY, radius) {
      if (!worldData) return;

      worldData.features.forEach(feature => {
        const geometry = feature.geometry;
        if (geometry.type === 'Polygon') {
          drawPolygon(geometry.coordinates, centerX, centerY, radius);
        } else if (geometry.type === 'MultiPolygon') {
          geometry.coordinates.forEach(polygon => {
            drawPolygon(polygon, centerX, centerY, radius);
          });
        }
      });
    }
    
    function drawPolygon(coordinates, centerX, centerY, radius) {
      coordinates.forEach(ring => {
        const projectedPoints = ring.map(([lon, lat]) => {
          const pos = project3D(lat, lon, radius * 0.99);
          return {
            x: centerX + pos.x,
            y: centerY + pos.y,
            z: pos.z,
            visible: pos.z > 0
          };
        });
        
        const hasVisiblePoint = projectedPoints.some(p => p.visible);
        if (!hasVisiblePoint) return;
        
        ctx.fillStyle = 'rgba(255, 255, 255, 0.08)';
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';
        ctx.lineWidth = 1.2;
        
        ctx.beginPath();
        let pathStarted = false;
        
        for (let i = 0; i < projectedPoints.length; i++) {
          const point = projectedPoints[i];
          const nextPoint = projectedPoints[(i + 1) % projectedPoints.length];
          
          if (point.visible) {
            if (!pathStarted) {
              ctx.moveTo(point.x, point.y);
              pathStarted = true;
            } else {
              ctx.lineTo(point.x, point.y);
            }
          } else if (pathStarted && !nextPoint.visible) {
            pathStarted = false;
          }
        }
        
        if (pathStarted) {
          ctx.closePath();
          ctx.fill();
          ctx.stroke();
        }
      });
    }

    function animate() {
      if (autoRotate) rotation.y += 0.005;
      drawGlobe();
      requestAnimationFrame(animate);
    }

    window.addEventListener('DOMContentLoaded', () => {
      init();
      loadWorldData();
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c57672171cd2630',t:'MTc2OTY3NTc5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
